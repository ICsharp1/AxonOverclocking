<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>API Testing - Axon Overclocking</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 30px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .header h1 {
      color: #667eea;
      margin-bottom: 10px;
    }

    .header p {
      color: #666;
    }

    .test-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 30px;
      border-radius: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .test-section h2 {
      color: #667eea;
      margin-bottom: 20px;
    }

    .test-controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .input-group {
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .input-group label {
      font-size: 14px;
      font-weight: 500;
      color: #333;
    }

    .input-group input,
    .input-group select {
      padding: 10px;
      border: 2px solid #e0e0e0;
      border-radius: 8px;
      font-size: 14px;
      transition: border-color 0.3s;
    }

    .input-group input:focus,
    .input-group select:focus {
      outline: none;
      border-color: #667eea;
    }

    button {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    button:active {
      transform: translateY(0);
    }

    .response-container {
      margin-top: 20px;
      padding: 20px;
      background: #f8f9fa;
      border-radius: 8px;
      border-left: 4px solid #667eea;
    }

    .response-container pre {
      margin: 0;
      overflow-x: auto;
      font-size: 13px;
      line-height: 1.5;
    }

    .status-badge {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .status-success {
      background: #d4edda;
      color: #155724;
    }

    .status-error {
      background: #f8d7da;
      color: #721c24;
    }

    .timing {
      font-size: 12px;
      color: #666;
      margin-top: 10px;
    }

    .link {
      color: #667eea;
      text-decoration: none;
      font-weight: 500;
    }

    .link:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>API Testing Interface</h1>
      <p>Test Content and Training Session APIs</p>
      <p style="margin-top: 10px;">
        <strong>Note:</strong> You must be <a href="/login" class="link">signed in</a> to use these APIs.
        Test credentials: alice / password123
      </p>
    </div>

    <!-- Content Words API Test -->
    <div class="test-section">
      <h2>1. Content Words API - GET /api/content/words</h2>

      <div class="test-controls">
        <div class="input-group">
          <label>Word Count</label>
          <input type="number" id="wordCount" value="20" min="1" max="50">
        </div>

        <div class="input-group">
          <label>Difficulty</label>
          <select id="difficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>

        <div class="input-group">
          <label>Min Length (optional)</label>
          <input type="number" id="minLength" placeholder="Leave empty for no limit">
        </div>

        <div class="input-group">
          <label>Max Length (optional)</label>
          <input type="number" id="maxLength" placeholder="Leave empty for no limit">
        </div>
      </div>

      <button onclick="testFetchWords()">Fetch Words</button>

      <div id="wordsResponse"></div>
    </div>

    <!-- Save Session API Test -->
    <div class="test-section">
      <h2>2. Training Session API - POST /api/training/save-session</h2>

      <div class="test-controls">
        <div class="input-group">
          <label>Training Type</label>
          <input type="text" id="trainingType" value="word-memory">
        </div>

        <div class="input-group">
          <label>Difficulty</label>
          <select id="sessionDifficulty">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
          </select>
        </div>

        <div class="input-group">
          <label>Score (0-100)</label>
          <input type="number" id="score" value="85" min="0" max="100">
        </div>

        <div class="input-group">
          <label>Time Spent (seconds)</label>
          <input type="number" id="timeSpent" value="118" min="1">
        </div>

        <div class="input-group">
          <label>Correct Count</label>
          <input type="number" id="correctCount" value="17" min="0">
        </div>

        <div class="input-group">
          <label>Incorrect Count</label>
          <input type="number" id="incorrectCount" value="2" min="0">
        </div>

        <div class="input-group">
          <label>Missed Count</label>
          <input type="number" id="missedCount" value="1" min="0">
        </div>
      </div>

      <button onclick="testSaveSession()">Save Session</button>

      <div id="sessionResponse"></div>
    </div>

    <!-- Complete Flow Test -->
    <div class="test-section">
      <h2>3. Complete Training Flow</h2>
      <p style="margin-bottom: 20px; color: #666;">
        This will fetch words, then immediately save a session using those words.
      </p>

      <button onclick="testCompleteFlow()">Run Complete Flow</button>

      <div id="flowResponse"></div>
    </div>
  </div>

  <script>
    // Utility function to display response
    function displayResponse(containerId, response, status, timing) {
      const container = document.getElementById(containerId);
      const statusClass = status >= 200 && status < 300 ? 'status-success' : 'status-error';
      const statusText = status >= 200 && status < 300 ? 'Success' : 'Error';

      container.innerHTML = `
        <div class="response-container">
          <span class="status-badge ${statusClass}">
            ${statusText} (${status})
          </span>
          <pre>${JSON.stringify(response, null, 2)}</pre>
          <div class="timing">Response time: ${timing}ms</div>
        </div>
      `;
    }

    // Test 1: Fetch Words
    async function testFetchWords() {
      const startTime = performance.now();

      try {
        const body = {
          count: parseInt(document.getElementById('wordCount').value),
          difficulty: document.getElementById('difficulty').value
        };

        const minLength = document.getElementById('minLength').value;
        const maxLength = document.getElementById('maxLength').value;

        if (minLength) body.minLength = parseInt(minLength);
        if (maxLength) body.maxLength = parseInt(maxLength);

        const response = await fetch('/api/content/words', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await response.json();
        const timing = Math.round(performance.now() - startTime);

        displayResponse('wordsResponse', data, response.status, timing);

        // Store words for later use
        window.lastFetchedWords = data.words;
      } catch (error) {
        const timing = Math.round(performance.now() - startTime);
        displayResponse('wordsResponse', { error: error.message }, 500, timing);
      }
    }

    // Test 2: Save Session
    async function testSaveSession() {
      const startTime = performance.now();

      try {
        const body = {
          trainingType: document.getElementById('trainingType').value,
          configuration: {
            difficulty: document.getElementById('sessionDifficulty').value,
            wordCount: 20,
            studyTime: 60,
            recallTime: 120
          },
          results: {
            score: parseFloat(document.getElementById('score').value),
            correctCount: parseInt(document.getElementById('correctCount').value),
            incorrectCount: parseInt(document.getElementById('incorrectCount').value),
            missedCount: parseInt(document.getElementById('missedCount').value),
            timeSpent: parseInt(document.getElementById('timeSpent').value)
          }
        };

        // Add content if we have fetched words
        if (window.lastFetchedWords && window.lastFetchedWords.length > 0) {
          body.contentUsed = window.lastFetchedWords.slice(0, 20).map(w => ({
            word: w.word,
            category: w.category
          }));
        }

        const response = await fetch('/api/training/save-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(body)
        });

        const data = await response.json();
        const timing = Math.round(performance.now() - startTime);

        displayResponse('sessionResponse', data, response.status, timing);
      } catch (error) {
        const timing = Math.round(performance.now() - startTime);
        displayResponse('sessionResponse', { error: error.message }, 500, timing);
      }
    }

    // Test 3: Complete Flow
    async function testCompleteFlow() {
      const startTime = performance.now();

      try {
        // Step 1: Fetch words
        const wordsResponse = await fetch('/api/content/words', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            count: 20,
            difficulty: 'medium'
          })
        });

        const wordsData = await wordsResponse.json();

        if (!wordsResponse.ok) {
          throw new Error(wordsData.error || 'Failed to fetch words');
        }

        // Step 2: Save session with fetched words
        const sessionResponse = await fetch('/api/training/save-session', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            trainingType: 'word-memory',
            configuration: {
              difficulty: 'medium',
              wordCount: 20,
              studyTime: 60,
              recallTime: 120
            },
            results: {
              score: Math.floor(Math.random() * 40) + 60, // Random 60-100
              correctCount: 17,
              incorrectCount: 2,
              missedCount: 1,
              timeSpent: 118
            },
            contentUsed: wordsData.words.slice(0, 20).map(w => ({
              word: w.word,
              category: w.category
            }))
          })
        });

        const sessionData = await sessionResponse.json();
        const timing = Math.round(performance.now() - startTime);

        if (!sessionResponse.ok) {
          throw new Error(sessionData.error || 'Failed to save session');
        }

        // Display combined result
        const result = {
          step1_fetchWords: {
            status: wordsResponse.status,
            wordCount: wordsData.words.length,
            excluded: wordsData.metadata.excludedCount,
            sampleWords: wordsData.words.slice(0, 5).map(w => w.word)
          },
          step2_saveSession: {
            status: sessionResponse.status,
            sessionId: sessionData.session.id,
            score: sessionData.session.score,
            performanceLevel: sessionData.session.performanceLevel,
            totalSessions: sessionData.progress.totalSessions,
            bestScore: sessionData.progress.bestScore,
            currentStreak: sessionData.progress.currentStreak
          }
        };

        displayResponse('flowResponse', result, 200, timing);
      } catch (error) {
        const timing = Math.round(performance.now() - startTime);
        displayResponse('flowResponse', { error: error.message }, 500, timing);
      }
    }

    // Auto-run a test on page load (optional)
    window.addEventListener('load', () => {
      console.log('API Test Interface loaded');
      console.log('Make sure you are signed in at /login before testing');
    });
  </script>
</body>
</html>
